{% extends 'base.html' %}
{% load tz %}

{% block title %}Алгоритмы - Сервис Алгоритмов{% endblock %}

{% block content %}
<h1>Алгоритмы</h1>

{% if user.is_authenticated %}
    <a href="{% url 'add_algorithm' %}" class="btn btn-primary" style="display: inline-block; margin-bottom: 20px;">+ Добавить алгоритм</a>
{% else %}
    <p>Чтобы добавлять алгоритмы, <a href="{% url 'login' %}">войдите</a> или <a href="{% url 'register' %}">зарегистрируйтесь</a>.</p>
{% endif %}

<div style="margin: 20px 0;">
    <form method="get" action="{% url 'algorithm_list' %}">
        <input type="text" 
               name="q" 
               value="{{ query|default:'' }}" 
               placeholder="Поиск по названию, тегам или автору..." 
               style="padding: 8px 12px; width: 300px; border: 1px solid #ddd; border-radius: 4px; font-size: 16px;">
        <button type="submit" style="padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px;">Найти</button>
        
        {% if query %}
            <a href="{% url 'algorithm_list' %}" style="margin-left: 10px; color: #007bff; text-decoration: none;">Очистить поиск</a>
        {% endif %}
    </form>
</div>

{% if query %}
    <div style="margin: 10px 0; color: #666;">
        {% if algorithms %}
            Найдено алгоритмов: {{ algorithms|length }}
        {% else %}
            По запросу "{{ query }}" ничего не найдено.
        {% endif %}
    </div>
{% endif %}

{% for algorithm in algorithms %}
    <div style="background: #f9f9f9; padding: 15px; margin: 10px 0; border-radius: 5px; border-left: 4px solid #4CAF50;">
        <h2>{{ algorithm.name }}</h2>
        <div style="color: #666; font-style: italic;">
            <strong>Теги:</strong> {{ algorithm.tegs }}
        </div>
        <p><strong>Описание:</strong> {{ algorithm.description }}</p>
        
        {% if algorithm.code %}
            <strong>Код:</strong>
            <pre style="background: #2d2d2d; color: #f8f8f2; padding: 15px; border-radius: 5px; overflow-x: auto; font-family: 'Courier New', monospace; margin: 10px 0;">{{ algorithm.code }}</pre>
        {% endif %}
        
        <div style="color: #888; font-size: 14px; margin-top: 10px; border-top: 1px solid #eee; padding-top: 10px;">
            <span style="font-weight: bold; color: #555;">Автор: {{ algorithm.author_name }}</span>
            <span style="font-size: 12px; color: #999;">
                | Создан: {% timezone "Europe/Moscow" %}{{ algorithm.created_at|date:"d.m.Y H:i" }}{% endtimezone %}
                {% if algorithm.updated_at != algorithm.created_at %}
                    | Обновлен: {% timezone "Europe/Moscow" %}{{ algorithm.updated_at|date:"d.m.Y H:i" }}{% endtimezone %}
                {% endif %}
            </span>
        </div>
    </div>
{% empty %}
    {% if query %}
        <p>По вашему запросу "{{ query }}" алгоритмов не найдено.</p>
    {% else %}
        <p>Алгоритмы пока не добавлены. 
            {% if user.is_authenticated %}
                <a href="{% url 'add_algorithm' %}">Добавить первый алгоритм</a>
            {% else %}
                <a href="{% url 'login' %}">Войдите</a>, чтобы добавить алгоритм.
            {% endif %}
        </p>
    {% endif %}
{% endfor %}
{% endblock %}